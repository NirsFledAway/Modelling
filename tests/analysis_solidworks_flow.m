clc; close all; clear variables;
data_a_v_10 = [...
-90 -0.030 -5.989 0.034;
-60 0.197 -4.972 0.028;
-45 0.498 -3.918 0.011;
-20 0.758 -1.577 0.001;
-10 0.692 -0.767 -0.001;
% 0 0.667 -0.035 -0.005;    % чутка другая сетка
0 0.715 -0.039 -0.005;
5 0.744 0.283 -0.004;
10 0.799 0.672 -0.003;
20 0.909 1.535 -0.002;
45 0.700 3.450 0.004;
60 0.476 4.300 0.024;
80 0.159 5.062 0.010;
90 0.059 5.305 -0.055
];
data_a_v_5 = [ ...
0 0.170 -0.008 -8.755e-04;
10 0.200 0.169 -4.831e-04;
20 0.230 0.380 -6.042e-04;
45 0.178 0.864 0.001;
60 0.121 1.073 0.007;
];
data_b_v_10 = [ ...
0 0.715 -0.039 -0.005;
2 0.735 -0.034 -0.031;
4 0.734 -0.028 -0.060;
5 0.740 0.018 -0.148;
6 0.735 -0.014 -0.089;
8 0.743 0.002 -0.117;
10 0.740 0.019 -0.148;
15 0.725 0.067 -0.220;
20 0.723 0.122 -0.289;
35 0.698 0.197 -0.532;
45 0.667 0.209 -0.686;
60 0.524 0.222 -0.817;
70 0.388 0.236 -0.874;
80 0.249 0.186 -0.880;
90 0.128 0.118 -0.913;
];
data_b_v_10_2 = [
    0 0.510750782 0.048812631 0.0018659518;
    1 0.510269705 0.0510295909 -0.0114903345;
    2 0.510226833 0.0525720207 -0.0236052354;
    3 0.510019553 0.0543651826 -0.034430989;
    4 0.509539792 0.058941421 -0.0457496607;
    5 0.508980348 0.0641436901 -0.0578028231;
    6 0.507891995 0.0708622506 -0.0690068488;
    7 0.512092481 0.0783884926 -0.0809145121;
    8 0.510593253 0.0851348394 -0.0936024648;
    9 0.510773651 0.0906726001 -0.104474556;
    10 0.511192177 0.098243529 -0.115103642;
];

data_b_v_allax_0 = [
0 1 3 4 5 6 7 8 9 10 12 14 16 18 20 22 24 26 28 30 32 34 36 38 40 42 44 46 48 50 52 54 56 58 60 62 64 66 68 70 72 74 76 78 80 82 84 85 86 87 88 89 90;
0.521453374 0.521685803 0.520600425 0.520481728 0.520701877 0.522059181 0.52204304 0.520210194 0.519318867 0.519706523 0.521249661 0.523985961 0.528143689 0.532225563 0.532784511 0.531682029 0.530092669 0.531164534 0.530763289 0.530190951 0.526327883 0.520537384 0.514721402 0.503649036 0.490747427 0.477901966 0.463513845 0.449657571 0.436323923 0.420396208 0.405384687 0.387726234 0.366798848 0.348423963 0.326766742 0.305405582 0.281748168 0.258086449 0.234712349 0.212298335 0.190730963 0.169952667 0.148871435 0.126464942 0.105164616 0.0837366225 0.0620881278 0.0534068369 0.0426501774 0.0322080563 0.0222293813 0.012308061 6.00557086e-05;
0.0403477504 0.0424224182 0.0430871656 0.0441063813 0.0485854865 0.050038372 0.0528161843 0.0592141944 0.0657831924 0.072854152 0.083991376 0.100444114 0.113210785 0.124675215 0.137259493 0.14685402 0.154137563 0.159824782 0.165956086 0.167797986 0.170353109 0.174010295 0.180896654 0.183928509 0.187782356 0.191013048 0.190755299 0.192735739 0.196294485 0.201177932 0.201530648 0.20956442 0.214943087 0.216422438 0.215321158 0.216910446 0.217505088 0.216273047 0.212049534 0.205057836 0.193486226 0.179559964 0.162465174 0.146548914 0.129894249 0.116064443 0.102835753 0.0962274673 0.0923744168 0.0913395408 0.089713359 0.0900426343 0.0892799383;
0.00323155903 -0.00990850952 -0.0371598652 -0.050763214 -0.0623378877 -0.0746899228 -0.0867961434 -0.0989441142 -0.109455159 -0.121402652 -0.143261635 -0.167543334 -0.190534192 -0.21448932 -0.241767147 -0.268300225 -0.295601432 -0.319112256 -0.343509457 -0.368361721 -0.394865981 -0.41830353 -0.44094935 -0.459620119 -0.477483262 -0.494446238 -0.509916332 -0.522359421 -0.535396236 -0.549001545 -0.559963751 -0.571278486 -0.582522546 -0.590460592 -0.598394672 -0.601800243 -0.605350503 -0.60674032 -0.607482769 -0.607791008 -0.607765306 -0.607013487 -0.606394364 -0.605892532 -0.605113919 -0.605159705 -0.603834828 -0.601889935 -0.601481908 -0.602144679 -0.601369702 -0.602138861 -0.600359924;
];
data_b_v_allax = data_b_v_allax_0';

data_hand_10_b = [
    
];
%%
a_10 = data_a_v_10(:, 1);
F_10 = sqrt(data_a_v_10(:, 2).^2 + data_a_v_10(:, 3).^2);
a_5 = data_a_v_5(:, 1);
F_5 = sqrt(data_a_v_5(:, 2).^2 + data_a_v_5(:, 3).^2);
b_10 = data_b_v_10(:, 1);
F_b_10 = sqrt(data_b_v_10(:, 2).^2 + data_b_v_10(:, 4).^2);
F_b_10_2 = sqrt(data_b_v_10_2(:, 2).^2 + data_b_v_10_2(:, 4).^2)
F_b_10_xyz = sqrt(data_b_v_10(:, 2).^2 + data_b_v_10(:, 3).^2 + data_b_v_10(:, 4).^2);
podgon = 1.371167655;
F_b_allax = podgon*(sqrt(data_b_v_allax(:, 2).^2 + data_b_v_allax(:, 4).^2));
% data_b_v_allax(:, 2) = F_b_allax;
b_allax = data_b_v_allax(:, 1);
%%
rho = 1.225;
Va = 10;
F_a_10_approx = calc_C_alpha(a_10)
%%
F_b_10_approx = calc_C_beta(b_10)
%%
close all;
figure;
hold on; grid on; grid minor; xlabel('\alpha, \beta'); ylabel("F");
plot(data_a_v_10(:, 1), data_a_v_10(:, 2));
plot(data_b_v_allax(:, 1), data_b_v_allax(:, 2));
%%
close all;
figure;
hold on; grid on; grid minor; xlabel('\alpha, \beta'); ylabel("F");
plot(a_10, F_10, '-x');
% plot(a_5, F_5, '-x');
% plot(a_10, F_a_10_approx, '-o');
% plot(a_10, 0.6969 + 4*2*sin(deg2rad(a_10)).^2 .* cos(deg2rad(a_10)))
plot(-90:90, calc_C_alpha(-90:90))
% plot(20:45, 4.9700 -7.5822e-04 *([20:45] -84.8228).^2)

%     plot(b_allax, F_b_allax, '-x');

% plot(b_10, F_b_10, '-x');
% plot(0:10, F_b_10_2, '-x');
% plot(b_10, F_b_10_approx, '-o');
% b = -360:10:360;
% b = sign(b).*mod(b, 180)   % приведение к диапазону 

% b = b + 180 * sign(90-b).*(abs(b)>90)
% plot(-360:0.01:360, calc_C_beta(b));
% plot(-500:0.01:500, calc_C_beta(-500:0.01:500))

% 2*sin(deg2rad(a_10)).^2 .* cos(deg2rad(a_10))
legend([
%     "F(\alpha), V=10m/s",
%     "F(\alpha), V=5m/s",
%     "F_{approx}(\alpha), V=10m/s",
    "F(\beta), V=10m/s"
    "F_{approx}(\beta), V=10m/s"
]);
%%
close all;
rho = 1.225;
f_cs_10 = 2*F_10/(rho*10^2)
f_cs_5 = 2*F_5/(rho*5^2);
figure; hold on; grid on; grid minor;
plot(a_10, f_cs_10);
plot(a_5, f_cs_5);
xlabel('\alpha');
ylabel('C');
legend([
    "f_{C_DS}, V=10m/s"
    "f_{C_DS}, V=5m/s"
]);
%%
function C_d1 = calc_C_alpha(a)
C_d1 = zeros(size(a));
    for i=1:length(a)
        alpha = a(i);
        if alpha >= 0 && alpha <= 20
            C_d = 0.6969 + 0.0022*(alpha+2.3409).^2;
        elseif alpha >= -20 && alpha < 0
            C_d = 0.6969 + 0.0022*(-alpha+2.3409).^2;
        elseif alpha > 20 && alpha <= 90
%             C_d = 5.0631 - 0.0005*(alpha - 101.9).^2;
%         C_d = -0.000461*alpha^2 + 0.101879*alpha - 0.128676;
        C_d = -0.000435*alpha^2 + 0.098161*alpha - 0.007685;
%         C_d = 5.5300 - 4.3500e-04*(alpha - 112.8287)^2;
%         C_d = 5.5 - 0.000461*(alpha - 110.4978).^2;
        else
            C_d = 5.5300 - 4.3500e-04*(-alpha - 112.8287)^2;
        end
        C_d1(i) = C_d;
    end
end

%% для старого уебанского варианта для мелкой сетки
% function C_d1 = calc_C_beta(b)
%     C_d1 = zeros(size(b));
%     for i=1:length(b)
%         x = b(i);
%         if x >= 0 && x <= 0.5
%             % b = 0.01706215266
%             % c = 0.7281553398
% %             C_d = 0.015*x^2 + 0.715;
% %             C_d = 0.715 + 0.01706215266*x^0.7281553398;
% %             C_d = 0.033828571429*x^2+0.000000000000*x+0.717211428571;
%             C_d = 0.715 + 0.0412*x^2;
%         elseif x > 0.5 && x <= 10
% %             C_d = 9.24479e-6*x^5 - 0.000257812*x^4 + 0.00265469*x^3 - 0.0123187*x^2 + 0.0262833*x + 0.715;
%             C_d = 8.48958e-6*x^5 - 0.000242708*x^4 + 0.00254896*x^3 - 0.0120167*x^2 + 0.0259933*x + 0.715;
%         elseif x > 10 && x <= 45
%             C_d = 0.000096261743*x^2+0.000839644777*x+0.726000794578;
% %             C_d = 0.000112709044*x^2-0.000205676560*x+0.740598223884;
%         elseif x > 45 && x <= 70
% %             C_d = -0.000094*x^2+0.010790*x+0.661600;
% %             C_d = -0.000094000000*x^2+0.010790000000*x+0.661599999999;
%             C_d = -0.000088933333*x^2+0.010131333333*x+0.682880000000;
%         elseif x > 70 && x <= 90
%             C_d = 0.000246*x^2 - 0.041080*x + 2.626500;
%         elseif x < 0 && x >= -0.5
%             C_d = 0.715 + 0.0412*x^2;
%         elseif x < -0.5 && x >= -10
%             C_d = -8.48958e-6*x^5 - 0.000242708*x^4 - 0.00254896*x^3 - 0.0120167*x^2 - 0.0259933*x + 0.715;
%         elseif x < -10 && x >= -45
%             C_d = 0.000096261743*x^2-0.000839644777*x+0.726000794578;
%         elseif x < -45 && x >= -70
%             C_d = -0.000088933333*x^2-0.010131333333*x+0.682880000000;
%         elseif x < -70 && x >= -90
%             C_d = 0.000246*x^2 + 0.041080*x + 2.626500;
%         else
%             C_d = 0;
%         end
%         C_d1(i) = C_d;
%     end
% end

%% для нового уебанского варианта с крупной сеткой
function C_d1 = calc_C_beta(b)
    C_d1 = zeros(size(b));
    b = mod(b + 180, 360) - 180;    % в диапазон -180...+180
    b = b + 180 * sign(90-b).*(abs(b)>90);   % в диапазон -90...+90
    for i=1:length(b)
        x = b(i);
        x = abs(x);
%         x = sign(x)*mod(x, 180);
%         x = x + 180 * sign(90-x)*(abs(x)>90);
        if x >= 0 && x <= 10
%             C_d = 3.54828e-7*x^6 - 7.32242e-6*x^5 + 0.0000375493*x^4 + 0.0000721637*x^3 - 0.000626833*x^2 + 0.000924087*x + 0.715;
            C_d = 2.81659e-7*x^6 - 5.42002e-6*x^5 + 0.0000194033*x^4 + 0.000149284*x^3 - 0.000766659*x^2 + 0.00100311*x + 0.715;
%         elseif x > 10 && x <= 16
%             C_d = 0.00038750*x^2-0.00370500*x+0.73004000;
        elseif x > 10 && x <= 32
            C_d = 0.000072941364*x^2+0.004725990899*x+0.676768850038;
        elseif x > 32 && x <= 47
%             C_d = -0.00018308*x^2+0.01742725*x+0.53333966;
%             C_d = -0.000201838954*x^2+0.018904484360*x+0.504469941351;
%             C_d = -0.000189803275*x^2+0.018001380743*x+0.521052052787;
%             C_d = 0.000015077031*x^3-0.002028316791*x^2+0.091836469277*x-0.453306918382;
            C_d = 0.000014983590*x^3-0.002016505717*x^2+0.091338487517*x-0.446303186240;
            
        elseif x > 47 && x <= 66
%             C_d = -0.00000536*x^3+0.00070298*x^2-0.02987262*x+1.35368571;
%             C_d = -0.000002905840*x^3+0.000298035756*x^2-0.007887188593*x+0.961834531510;
            C_d = -0.000005286789*x^3+0.000705178007*x^2-0.030877630605*x+1.390205322532;
        elseif x > 66 && x <= 90
            C_d = 0.000000379469*x^3+0.000021666922*x^2-0.013615025702*x+1.599215019960;            
        else
            C_d = 0;
        end
        C_d1(i) = C_d;
    end
%     C_d1
end
